{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Результаты поиска</title>
  <link rel="stylesheet" href="{% static 'css/content.css' %}" />
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<div class="search_block">
  <a href="index.html"><div class="back_button"></div></a>
  <form class="searcher" onsubmit="return handleSearch(event)">
    <img class="search_icon" src="{% static 'images/search icon.png' %}">
    <input class="searcher_block" id="searchInput" placeholder="Поиск..." />
  </form>
</div>

<div class="choosed_genre"><span class="red">Результаты</span> поиска:</div>

<div class="content_body" id="searchResults"></div>

<script>
  const params = new URLSearchParams(window.location.search);
  const query = params.get("query")?.toLowerCase() || "";
  const searchInput = document.getElementById("searchInput");
  if (searchInput) searchInput.value = query;

  const allContent = JSON.parse(localStorage.getItem("all_content")) || [];
  const resultsContainer = document.getElementById("searchResults");

  const filtered = allContent.filter(item => {
    return (
      item.title?.toLowerCase().includes(query) ||
      item.subtitle?.toLowerCase().includes(query)
    );
  });

  if (filtered.length === 0) {
    resultsContainer.innerHTML = `<div class="no_results">Ничего не найдено</div>`;
  } else {
    filtered.forEach(item => {
      const block = document.createElement("div");
      block.className = "content_block";
      block.innerHTML = `
        <div class="fav_icon not_favourited" data-id="${item.id}"></div>
        <div class="content_info" onclick="window.open('${item.telegram_url}', '_blank')">
          <div class="content_title">${item.title}</div>
          <div class="content_subtitle">${item.subtitle}</div>
        </div>
      `;
      resultsContainer.appendChild(block);
    });
  }

  function handleSearch(e) {
    e.preventDefault();
    const value = document.getElementById("searchInput").value.trim();
    if (value) {
      window.location.href = `searched.html?query=${encodeURIComponent(value)}`;
    }
    return false;
  }
</script>

</body>
</html>
